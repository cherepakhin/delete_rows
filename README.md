# delete_rows
Реализовать API с использованием которое позволит удалять данные из реляционной БД  таблиц объемом 10 млн строк и более. Ключ, по которому производится удаление данных, столбец DateTime (удаляем старые данные). Работа системы не должна приводить к длительным блокировкам данных. АPI может вызываться несколькими внешними процессами одновременно. (1 процесс удаляет данные в 1 таблице). Необходимо обеспечить логирование работы API.  

### Запуск

Используется __Java 11__  и __PostgreSQL__ сервер. Для запуска выполнить команду

```sh
mvn spring-boot:run
```

### Переменные окружения

| Название | Пример и значение по умолчанию | Описание |
| --- |------- | ------ |
| PG_URL | jdbc:postgresql://localhost:5432/db | Адрес PostgreSQL |
| PG_USER | postgres | Имя пользователя БД |
| PG_PASSWORD | postgres | Пароль пользователя БД |

### Использование

После запуска будут доступе REST сервис по адресу http://localhost:8080

| EndPoint | HTTP-метод | Переменные запроса | Описание |
| --- |------- | ------ |------ |
| /new_table |POST | table,length |Создать таблицу с именем __table__ и сгенерировать __length__ записей |
| /drop_table |POST | table |Удалить таблицу с именем __table__ |
| /in_select |POST | table,fromDate,portion |Удалить из таблицы с именем __table__ записи старее __fromDate__. Удалять порциями по __portion__ записей. Используется способ: *delete from table where id in (select id from table where ddate<:fromDate limit portion*)|

### Примеры

Создание таблицы t1 с 10000 записями

````shell script
curl -X POST -F 'table=t1' -F 'length=10000' http://127.0.0.1:8080/create_table

----log----
Создание таблицы t1 c длиной 10000
Время выполнения: 496 мс
````

Удаление таблицы t1

````shell script
curl -X POST -F 'table=t1' http://127.0.0.1:8080/drop_table

----log----
Запуск таймера
Удаление таблицы t1
Время выполнения: 20 мс
````

Удаление из таблицы t1 записи старее 2121-01-01 01:02:03 методом delete from select

````shell script
curl -X POST -F 'table=t1' -F 'fromDate="2121-01-01 01:02:03"' -F 'portion=1000' http://127.0.0.1:8080/in_select

----log----
Запуск таймера
В таблице t1 записей для удаления 10000
Удалено 0 из 10000 
Удалено 1000 из 10000
.... 
Удалено 10000 из 10000 
Время выполнения: 76 мс
````




